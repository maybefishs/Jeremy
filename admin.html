<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LunchVote+ 管理後台 v2.0</title>
    <link rel="icon" href="./lunchvote.png" type="image/png" />
    <link rel="stylesheet" href="./styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/utc.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/timezone.js"></script>
</head>
<body data-page="admin">
    <header class="top-bar">
        <div class="brand">
            <span class="badge badge-accent">管理後台 v2.0</span>
            <h1>LunchVote+ Admin</h1>
            <p class="tagline">模組化菜單管理系統</p>
        </div>
    </header>

    <main>
        <section class="card shell">
            <h2>營運設定</h2>
            <form id="settingsForm" class="settings-grid">
                <div class="field-group">
                    <label for="mode-select">系統模式</label>
                    <select name="mode" id="mode-select">
                        <option value="vote">投票模式</option>
                        <option value="order">直接點餐</option>
                    </select>
                </div>
                <div class="field-group">
                    <label for="baseDate-input">基準日期</label>
                    <input type="date" name="baseDate" id="baseDate-input">
                </div>
                <div class="field-group">
                    <label for="timezone-select">時區</label>
                    <select name="timezone" id="timezone-select">
                        <option value="Asia/Taipei">Asia/Taipei</option>
                    </select>
                </div>
                <div class="field-group">
                    <label for="voteCutoff-input">投票截止時間</label>
                    <input type="time" name="voteCutoff" id="voteCutoff-input" step="60">
                </div>
                <div class="field-group">
                    <label for="orderCutoff-input">點餐截止時間</label>
                    <input type="time" name="orderCutoff" id="orderCutoff-input" step="60">
                </div>
                <div class="field-group">
                    <label class="toggle">
                        <input type="checkbox" name="requiresPreorder">
                        <span>全日需預訂</span>
                    </label>
                </div>
            </form>
        </section>

        <section class="card shell">
            <h2>名單管理</h2>
            <div class="names-import">
                <textarea id="namesTextarea" placeholder="貼上名單，用換行、逗號或空格分隔"></textarea>
                <div class="import-actions">
                    <button id="importNamesBtn" class="primary">匯入名單</button>
                    <label class="ghost">從 CSV 匯入<input type="file" id="importCsv" accept=".csv" class="hidden"></label>
                </div>
            </div>
            <ul id="namesList" class="names-list"></ul>
        </section>
        
        <section class="card shell">
            <h2>餐廳列表</h2>
            <form id="restaurantForm" class="restaurant-form">
                <input type="text" name="name" placeholder="新增餐廳名稱" required>
                <label class="toggle">
                    <input type="checkbox" name="requiresPreorder">
                    <span>需預訂</span>
                </label>
                <button type="submit" class="primary">新增</button>
            </form>
            <div id="restaurantsList"></div>
        </section>

        <section class="card shell">
            <h2>餐廳與菜單 (v2.0)</h2>
            <select id="restaurantSelect" class="field-group">
                <option value="">請先選擇要編輯的餐廳</option>
            </select>
            <div id="menuEditorV2" class="hidden">
                <h4>總菜單圖片管理</h4>
                <form id="menuImageForm" class="menu-image-form">
                    <input type="url" id="menuImageUrl" placeholder="貼上總菜單圖片網址" required />
                    <button type="submit" class="ghost">新增圖片</button>
                </form>
                <div id="menuImagesContainer" class="menu-images-container"></div>
                <hr style="margin: 24px 0;">
                <h3>分類管理</h3>
                <form id="categoryForm" class="category-form">
                    <input type="text" id="categoryName" placeholder="輸入分類名稱 (e.g., 麵類)" required/>
                    <button type="submit" class="ghost">新增分類</button>
                </form>
                <div id="categoryContainer" class="category-container"></div>
            </div>
        </section>
        
        <section class="card shell">
            <h2>備份與維運</h2>
            <div class="backup-grid">
                <div class="field-group">
                    <label class="toggle">
                        <input type="checkbox" id="backupToggle">
                        <span>啟用遠端備份</span>
                    </label>
                </div>
                <input type="url" id="backupUrl" placeholder="輸入備份網址 (e.g., Google Apps Script)">
                <div class="backup-actions">
                    <button id="backupNow" class="primary">立即備份</button>
                    <button id="restoreBackup" class="ghost">從遠端還原</button>
                    <button id="clearOldRecords" class="danger">清除30天前舊資料</button>
                </div>
            </div>
        </section>

        <div id="setupWizard" class="modal hidden">
            <div class="modal-content">
                <h2>首次設定精靈</h2>
                <div id="wizardStep1" class="wizard-step" data-step="1">
                    <p>歡迎使用 LunchVote+！讓我們花一分鐘完成基本設定。</p>
                    <button data-next class="primary">開始</button>
                </div>
                <div id="wizardStep2" class="wizard-step" data-step="2">
                    <p>請貼上或匯入您的名單。</p>
                    <div class="names-import">
                        <textarea id="wizardNamesTextarea" placeholder="貼上名單..."></textarea>
                    </div>
                    <div class="wizard-nav">
                        <button data-prev class="ghost">上一步</button>
                        <button data-next class="primary">下一步</button>
                    </div>
                </div>
                <div id="wizardStep3" class="wizard-step" data-step="3">
                    <p>太棒了！這是您的專屬海報，把它印出來給學生掃描吧。</p>
                    <canvas id="wizardCanvas" width="800" height="600" style="width: 100%; height: auto; border: 1px solid #ccc;"></canvas>
                    <div class="wizard-nav">
                         <button data-prev class="ghost">上一步</button>
                         <button id="downloadPoster" class="primary">下載海報</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="itemEditorModal" class="modal hidden">
        <div class="modal-content">
            <h2 id="modalTitle">編輯品項</h2>
            <form id="itemEditorForm">
                <input type="hidden" name="itemId"><input type="hidden" name="categoryId">
                <label>品項名稱: <input type="text" name="name" required></label>
                <label>基礎價格: <input type="number" name="basePrice" required min="0"></label>
                <label>單位 (e.g., 顆, 份): <input type="text" name="unit"></label>
                <label>圖片網址: <input type="url" name="imageUrl" placeholder="https://..."></label>
                <hr>
                <h3>選項群組</h3>
                <div id="optionGroupsContainer"></div>
                <button type="button" id="addOptionGroupBtn" class="ghost">新增選項群組</button>
                <div class="modal-actions">
                    <button type="button" class="ghost" onclick="document.getElementById('itemEditorModal').classList.add('hidden')">取消</button>
                    <button type="submit" class="primary">儲存品項</button>
                </div>
            </form>
        </div>
    </div>

    <div id="pinModal" class="modal">
        <div class="modal-content">
            <div id="setPinPanel" class="hidden">
                <h2>首次設定 PIN</h2>
                <form id="setPinForm">
                    <input type="password" id="newPin" placeholder="請設定 4 位以上 PIN" required>
                    <input type="password" id="confirmPin" placeholder="再次確認 PIN" required>
                    <button type="submit">設定</button>
                    <p id="setPinError" class="error"></p>
                </form>
            </div>
            <form id="pinForm">
                <h2>請輸入管理 PIN</h2>
                <input type="password" id="pinInput" required>
                <button type="submit">解鎖</button>
                <p id="pinError" class="error"></p>
            </form>
        </div>
    </div>

    <script type="module" src="./app.js"></script>
    <script type="module" src="./admin.js"></script>
</body>
</html>
